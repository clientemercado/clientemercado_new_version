@model ClienteMercado.UI.Core.ViewModel.CadastroEmpresaViewModel

<!DOCTYPE html>
<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.2
Version: 3.7.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8" />
    <title>ClienteMercado | Login</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="~/Content/assets/global/plugins/select2/select2.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/admin/pages/css/login-soft.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME STYLES -->
    <link href="~/Content/assets/global/css/components.css" id="style_components" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link id="style_color" href="~/Content/assets/admin/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/sweetalert.css" rel="stylesheet" />
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="login">
    <!-- BEGIN LOGO -->
    <div class="logo">
        <a href="index.html">
            <img src="~/Content/images/logo_branca.png" alt="" />
        </a>
    </div>
    <!-- END LOGO -->
    <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
    <div class="menu-toggler sidebar-toggler">
    </div>
    <!-- END SIDEBAR TOGGLER BUTTON -->
    <!-- BEGIN LOGIN -->
    <div class="content">
        <div id="cadastroEmpresa">
            <!-- BEGIN LOGIN FORM -->
            <h3 class="form-title">Dados de sua Empresa:</h3>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fas fa-keyboard"></i>
                    <input type="text" class="form-control" id="inCNPJ" placeholder="CNPJ" obrigatorio="1" maxlength="18" size="30" value="" tabindex="1" onClick="limparCampoCNPJ_New();" onKeyDown="FormataCNPJ(this, event);" onkeypress="return event.charCode >= 48 && event.charCode <= 57" />
                    <img style="margin-left:20px;margin-top:0px;display:none;" id="img_load_direcionada1" src="@Url.Content("~/Content/images/ajax-loader_.gif")">
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fas fa-pencil-alt"></i>
                    <input type="text" class="form-control" id="inRazaoSocial" placeholder="Razão Social" obrigatorio="1" maxlength="100" tabindex="2" size="30" />
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="far fa-envelope"></i>
                    <input type="text" class="form-control" id="inEmail1" placeholder="E-mail" obrigatorio="1" maxlength="50" size="30" value="" tabindex="3" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');" />
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fa fa-user"></i>
                    <input type="text" class="form-control" id="inNomeUsuario" placeholder="Nome Usuário" obrigatorio="1" maxlength="50" size="30" value="" tabindex="4" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');" />
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fas fa-sign-in-alt"></i>
                    <input type="text" class="form-control cmplogin" id="inLogin" placeholder="Login" obrigatorio="1" onClick="limparCampoLogin_New();" tabindex="5" maxlength="30" size="30" />
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fa fa-lock"></i>
                    <input type="password" class="form-control" id="inPassw" placeholder="Senha" obrigatorio="1" maxlength="30" size="30" value="" tabindex="6" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');" />
                </div>
            </div>

            <div id="msg-erro-cnpj-1" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">CNPJ Inválido</font></h4>
            </div>
            <div id="msg-erro-cnpj-2" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">CNPJ já cadastrado</font></h4>
            </div>
            <div id="msg-erro-login" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">Login já cadastrado para outro Usuário</font></h4>
            </div>
            <div id="msg-erro-email" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">E-mail inválido</font></h4>
            </div>
            <div id="msg-erro-campos" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">Campo(s) obrigatório(s)</font></h4>
            </div>
            <div id="msg-erro-cadastro" class="alert alert-danger" role="alert" style="text-align:center;display:none;">
                <h4><font color="red">Não foi possível Cadastrar! Tente mais tarde.</font></h4>
            </div>
            <div>
                <button id="btn-criarConta" class="btn blue pull-right reload" disabled>Criar Conta <i class="m-icon-swapright m-icon-white"></i></button>
            </div>
            <div class="forget-password">&nbsp;</div>
            <div class="create-account" style="text-align:center;vertical-align:middle;">&nbsp;</div>
        </div>
        <div id="confirmacaoCadastro" style="display:none;">
            <div id="confirmacao_agradecimento" style="width: 100%; font-size:18px; color: #FFF; float:left; text-align:center; line-height:50px;">
                <h3><font color="red">Seu cadastro foi efetuado com sucesso!</font></h3>
                <br />
                <h4><font color="red">Acesse o e-mail informado no cadastro e clique no link que lhe enviamos, para confirmar o cadastro!</font></h4>
            </div>
            <br />
            <div id="confirmacao_imprimir">
                <a href='@Url.Action("LogOut", "Login", new {area = ""})'><h4>Início</h4></a>
            </div>
        </div>
    </div>
    <!-- END LOGIN -->
    <!-- BEGIN COPYRIGHT -->
    <div class="copyright">
        2020 &copy; ClienteMercado
    </div>
    <!-- END COPYRIGHT -->
    <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
    <!-- BEGIN CORE PLUGINS -->
    <!--[if lt IE 9]>
    <script src="../../assets/global/plugins/respond.min.js"></script>
    <script src="../../assets/global/plugins/excanvas.min.js"></script>
    <![endif]-->
    <script src="~/Content/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="~/Content/assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/backstretch/jquery.backstretch.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/plugins/select2/select2.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="~/Content/assets/global/scripts/metronic.js" type="text/javascript"></script>
    <script src="~/Content/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
    <script src="~/Content/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
    <script src="~/Content/assets/admin/pages/scripts/login-soft.js" type="text/javascript"></script>
    <script src="~/Scripts/sweetalert-dev.js"></script>
    <script src="~/Scripts/sweetalert.min.js"></script>
    <script src="~/Scripts/validacoes.js"></script>
    @*<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>*@
    <script>
        jQuery(document).ready(function() {
              //Metronic.init(); // init metronic core components
              //Layout.init(); // init current layout
              //Login.init();
              //Demo.init();
            debugger;

            pais = "";

            $.getJSON('http://api.wipmania.com/jsonp?callback=?', function (data) {
                debugger;

                //alert('País: ' + data.address.country);
                pais = data.address.country;
            });

                $("#inRazaoSocial").attr("disabled", true);
                $("#inEmail1").attr("disabled", true);
                $('#inNomeUsuario').attr("disabled", true);
                $('#inLogin').attr("disabled", true);
                $('#inPassw').attr("disabled", true);

               //IMAGENS de FUNDO ALTERNÁVEIS
              $.backstretch([
                "../../Content/assets/admin/pages/media/bg/1.jpg",
                "../../Content/assets/admin/pages/media/bg/2.jpg",
                "../../Content/assets/admin/pages/media/bg/3.jpg",
                "../../Content/assets/admin/pages/media/bg/4.jpg"
                ], {
                  fade: 1000,
                  duration: 8000
                }
              );

            //Ajax - Consulta CNPJ
              $("#inCNPJ").blur(function () {
                  if ($("#inCNPJ").val() != '') {
                      $('#img_load_direcionada1').show();

                      $.ajax({
                          type: 'POST',
                          url: '/Registration_company/VerificaSeCNPJExisteNoBanco', //Caminho Controler/Action
                          dataType: 'json', //Tipo de dados
                          data: { 'cnpjDigitado': $("#inCNPJ").val() }, //Valor passado por parâmetro
                          success: function (result) {
                              $('#img_load_direcionada1').hide();
                              debugger;

                              ////Retorno Json
                              //$("#mensagemErroCnpj2").html('');

                              ////Destaque campos identificação e Desabilita/Habilita botão submit
                              //if (result != true) {
                                  //$("#mensagemErroCnpj2").html(result.mensagem).css("color", "#FF0000");

                              if (result.validacaoCNPJ == 'cnpjjacadastrado') {
                                  //Se CNPJ já cadastrado, exibe dados identificadores da Empresa
                                  $("#inRazaoSocial").val(result.razaoSocial).css("background-color", "#F5F5AB").attr("disabled", true);
                                  $("#inEmail1").val(result.eMailOne).css("background-color", "#F5F5AB").attr("disabled", true);
                                      //$("#TELEFONE1_EMPRESA_USUARIO").val(result.telefoneOne).attr("disabled", true);
                                      //$("#PAIS_EMPRESA_USUARIO").val(result.pais).attr("disabled", true);
                                      //$("#CEP_SEQUENCIAL_ENDERECO").val(result.cep).attr("disabled", true);
                                      //$("#ENDERECO_EMPRESA_USUARIO").val(result.endereco).attr("disabled", true);
                                      //$("#COMPLEMENTO_ENDERECO_EMPRESA_USUARIO").val(result.complementoEndereco).attr("disabled", true);
                                      //$("#NOME_ESTADO_EMPRESA_USUARIO").val(result.ufEstado).attr("disabled", true);
                                      //$("#NOME_CIDADE_EMPRESA_USUARIO").val(result.cidade).attr("disabled", true);
                                      //$("#NOME_BAIRRO_EMPRESA_USUARIO").val(result.bairro).attr("disabled", true);
                                      //$('#USUARIO_CONFIRMADO_EMPRESA_CONFIGURADA').val(result.confirmacaoDeCadastro).attr("disabled", true);

                                      //$("#ID_EMPRESA").val(result.idEmpresa);
                                      //$("#RECEBER_EMAILS_EMPRESA").attr("checked", true); //Checa
                                      //$("#ID_CODIGO_TIPO_EMPRESA_USUARIO").val(1); //Valor 1 -> Indica que é Empresa
                                      //$("#ACEITACAO_TERMOS_POLITICAS").val(true);
                                      //$("#ATIVA_INATIVA_EMPRESA").val(true);
                                      //$("#EMPRESA_ADMISTRADORA").val(false); //True somente para ClienteMercado
                                      //$("#ID_GRUPO_ATIVIDADES").val(result.grupoAtividades);

                                      ////Decide qual botão de cadastro de segundo usuário, irá exibir
                                      //if (result.confirmacaoDeCadastro != true) {
                                      //    //Botão fake
                                      //    $("#btn_cadastro2_alter").show();
                                      //} else {
                                      //    //Botão verdadeiro
                                      //    $("#btn_cadastro2").show();
                                      //}

                                  $('#inNomeUsuario').attr("disabled", true);
                                  $('#inLogin').attr("disabled", true);
                                  $('#inPassw').attr("disabled", true);

                                  $('#msg-erro-campos').hide();
                                  $('#msg-erro-cnpj-1').hide();
                                  $('#msg-erro-cnpj-2').show();
                              }
                              else if (result.validacaoCNPJ == 'cnpjinvalido') {
                                  //Se CNPJ for INVÁLIDO
                                  $("#inRazaoSocial").val('').css("background-color", "#FFFFFF").attr("disabled", false);
                                  $("#inEmail1").val('').css("background-color", "#FFFFFF").attr("disabled", false);
                                  $('#inNomeUsuario').val('');
                                  $('#inLogin').val('');
                                  $('#inPassw').val('');

                                  $("#inRazaoSocial").attr("disabled", true);
                                  $("#inEmail1").attr("disabled", true);
                                  $('#inNomeUsuario').attr("disabled", true);
                                  $('#inLogin').attr("disabled", true);
                                  $('#inPassw').attr("disabled", true);
                                  $('#msg-erro-campos').hide();
                                  $('#msg-erro-cnpj-2').hide();
                                  $('#msg-erro-cnpj-1').show();
                              }
                              else if (result.validacaoCNPJ == 'cnpjnaocadastrado') {
                                  //Se CNPJ NÃO CADASTRADO
                                  $("#inRazaoSocial").val('').css("background-color", "#FFFFFF").attr("disabled", false);
                                  $("#inEmail1").val('').css("background-color", "#FFFFFF").attr("disabled", false);
                                  $('#inNomeUsuario').val('');
                                  $('#inLogin').val('');
                                  $('#inPassw').val('');

                                  $('#inNomeUsuario').attr("disabled", false);
                                  $('#inLogin').attr("disabled", false);
                                  $('#inPassw').attr("disabled", false);

                                  $('#msg-erro-cnpj-1').hide();
                                  $('#msg-erro-cnpj-2').hide();

                                  $('#inRazaoSocial').focus();
                              }
                          }
                      });
                  }
              });

              $("#inRazaoSocial").change(function () {
                  if ($("#inRazaoSocial").val() != "") {
                      $('#btn-criarConta').attr("disabled", false);
                  }
                  else {
                      $('#btn-criarConta').attr("disabled", true);
                  }
              });

            //CADASTRAR EMPRESA
            $(document).on("click", "#btn-criarConta", function () {
                debugger;

                var cont = 0;
                var msg = "";
                var obj = {};
                var aviso = 0;
                var mensagem = "ATENÇÃO!!!\n\nOs CAMPOS em vermelho, são de preenchimento obrigatório!"

                $("input[type=text]").each(function () {
                    debugger;

                    if (($("#inEmail1").val() == "") || ($("#inNomeUsuario").val() == "") || ($("#inLogin").val() == "") || ($("#inPassw").val() == "")) {
                        aviso = 1;

                        if ($("#inNomeUsuario").val() == "") {
                            $("#inNomeUsuario").css({ backgroundColor: "#FFFFE0" });
                        }

                        if ($("#inEmail1").val() == "") {
                            $("#inEmail1").css({ backgroundColor: "#FFFFE0" });
                        }

                        if ($("#inLogin").val() == "") {
                            $("#inLogin").css({ backgroundColor: "#FFFFE0" });
                        }

                        if ($("#inPassw").val() == "") {
                            $("#inPassw").css({ backgroundColor: "#FFFFE0" });
                        }
                    }
                    else if (($(this).val() != ""))
                        obj[$(this).attr("id")] = $(this).val();
                });

                if (aviso == 1) {
                    $('#msg-erro-campos').show();

                    if ($("#inEmail1").val() == "") {
                        $("#inEmail1").focus();
                    }
                    else if ($("#inListaDeRamosDeAtividade").val() == "") {
                        $("#inListaDeRamosDeAtividade").focus();
                    }
                    else if ($("#inPassw").val() == "") {
                        $("#inPassw").focus();
                    }
                }
                else {
                    debugger;

                    $('#msg-erro-campos').hide();
                    $('#btn-criarConta').attr("disabled", true);

                    $.ajax({
                        type: 'POST',
                        url: '/Registration_company/CadastroBasicoDaEmpresa', //Caminho Controler/Action
                        dataType: 'json', //Tipo de dados
                        data: {
                            'cnpj': $("#inCNPJ").val(),
                            'razaoSocial': $('#inRazaoSocial').val(),
                            'email1': $('#inEmail1').val(),
                            'nomeUsuario': $('#inNomeUsuario').val(),
                            'login': $('#inLogin').val(),
                            'passw': $('#inPassw').val(),
                            'pais': pais
                        },
                        success: function (result) {
                            //Desabilita/Habilita botão submit
                            if (result.cadastroBasicoEfetuado == "Ok") {
                                $('#cadastroEmpresa').hide();
                                $('#confirmacaoCadastro').show();
                            } else {
                                $('#msg-erro-cadastro').hide();
                            }
                        }
                    });
                }
            });

            //===================================================================
              //CCONSULTA a EXISTÊNCIA do LOGIN
              $("#inLogin").blur(function () {
                  debugger;

                  if ($("#inLogin").val() != '') {
                      $('#img_load_direcionada3').show();

                      $.ajax({
                          type: 'POST',
                          url: '/Registration_company/VerificaSeLoginJaExisteNoBanco', //Caminho Controler/Action
                          dataType: 'json', //Tipo de dados
                          data: { 'loginDigitado': $("#inLogin").val() }, //Valor passado por parâmetro
                          success: function (result) {
                              $('#img_load_direcionada3').hide();

                              //Desabilita/Habilita botão submit
                              if (result.resultadoLogin == "jaexiste") {
                                  $('#msg-erro-campos').hide();
                                  $("#msg-erro-login").show();
                                  $('#inLogin').focus();

                              } else {
                                  $('#inLogin').css({ backgroundColor: "#FFFFFF" });
                                  $("#msg-erro-login").hide();
                                  $("#inPassw").attr("disabled", false);
                                  $("#inPassw").focus();
                              }
                          }
                      });
                  }
              });

              //VALIDAR E-MAIL
              $("#inEmail1").blur(function () {
                  debugger;

                  if ($("#inEmail1").val() != "") {
                      $.ajax({
                          type: 'POST',
                          url: '/Registration_company/ValidarEmail', //Caminho Controler/Action
                          dataType: 'json', //Tipo de dados
                          data: { 'emailAValidar': $("#inEmail1").val() }, //Valor passado por parâmetro
                          success: function (result) {
                              $('#img_load_direcionada3').hide();

                              //Desabilita/Habilita botão submit
                              if (result.emailValido == "Ok") {
                                  $("#inEmail1").css({ backgroundColor: "#FFFFFF" });
                                  $("#msg-erro-email").hide();
                              } else {
                                  $('#msg-erro-campos').hide();
                                  $("#msg-erro-email").show();
                                  $('#inEmail1').focus();
                              }
                          }
                      });
                  }
              });

              $("#inPassw").blur(function () {
                  if ($("#inPassw").val() != "") {
                      $("#inPassw").css({ backgroundColor: "#FFFFFF" });

                      if (($("#inEmail1").val() != "") && ($("#inNomeUsuario").val() != "") && ($("#inLogin").val() != "")) {
                          $('#msg-erro-campos').hide();
                      }
                  }
              });
            //===================================================================
        });

        //LIMPAR CAMPO CNPJ
        function limparCampoCNPJ_New() {
            $('#inCNPJ').val('');
            $("#inRazaoSocial").val('').css("background-color", "#FFFFFF");
            $("#inEmail1").val('').css("background-color", "#FFFFFF");
            $('#inNomeUsuario').val('');
            $('#inLogin').val('');
            $('#inPassw').val('');

            $('#btn-criarConta').attr("disabled", true);

            $("#inRazaoSocial").attr("disabled", true);
            $("#inEmail1").attr("disabled", true);
            $('#inNomeUsuario').attr("disabled", true);
            $('#inLogin').attr("disabled", true);
            $('#inPassw').attr("disabled", true);

            $('#msg-erro-cnpj-1').hide();
            $('#msg-erro-cnpj-2').hide();

            $('#inCNPJ').focus();
        }

        //LIMPAR CAMPO LOGIN
        function limparCampoLogin_New() {
            $('#inLogin').val('');
            $('#inPassw').val('');
            $('#inPassw').attr("disabled", true);

            $('#msg-erro-cnpj-1').hide();
            $('#msg-erro-cnpj-2').hide();
            $('#msg-erro-login').hide();

            $('#inLogin').focus();
        }
    </script>
    <!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>

